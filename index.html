<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Razorpay Dynamic Payment</title>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<style>
body { font-family: Arial; padding: 20px; }
input, button { padding: 10px; margin: 5px 0; width: 100%; }
</style>
</head>
<body>
<h1>Pay Securely</h1>

<input type="text" id="name" placeholder="Enter your full name" required />
<input type="email" id="email" placeholder="Enter your email" required />
<input type="tel" id="contact" placeholder="Enter your contact number" required />
<input type="number" id="amount" placeholder="Enter amount" required />
<button id="payBtn">Pay Now</button>

<div id="status"></div>

<script>
document.getElementById("payBtn").onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const amount = document.getElementById("amount").value.trim();

  if (!name || !email || !contact || !amount || amount <= 0) {
    alert("Please fill all fields correctly");
    return;
  }

  // 1️⃣ Create order on server
  const orderRes = await fetch("http://localhost:3000/create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ amount })
  });

  const order = await orderRes.json();

  // 2️⃣ Open Razorpay checkout
  const options = {
    key: "rzp_live_R5hlTuJJg2PACA",  // Your test key
    amount: order.amount,
    currency: order.currency,
    name: "Secure Shop",
    description: "Payment Transaction",
    order_id: order.id,
    prefill: { name, email, contact },
    theme: { color: "#3399cc" },
    handler: async function (response) {
      document.getElementById("status").innerText = "Verifying payment...";
      
      // 3️⃣ Verify payment on server
      const verifyRes = await fetch("http://localhost:3000/verify-payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(response)
      });

      const result = await verifyRes.json();
      if(result.status === "success"){
        document.getElementById("status").innerHTML = `<span style="color:green">${result.message}<br>Payment ID: ${response.razorpay_payment_id}</span>`;
      } else {
        document.getElementById("status").innerHTML = `<span style="color:red">${result.message}</span>`;
      }
    },
    modal: {
      ondismiss: function(){
        document.getElementById("status").innerText = "Payment cancelled by user";
      }
    }
  };

  new Razorpay(options).open();
};
</script>
</body>
</html>

